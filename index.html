<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Global Crypto Portfolio Dashboard</title>
    <style>
      :root {
        color-scheme: dark;
        --bg: #0d1117;
        --panel: #161b22;
        --accent: #3b82f6;
        --accent-soft: rgba(59, 130, 246, 0.2);
        --text: #e6edf3;
        --muted: #8b949e;
        --positive: #22c55e;
        --negative: #ef4444;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: radial-gradient(circle at top, #151c2b 0%, #0d1117 45%);
        color: var(--text);
      }

      .shell {
        max-width: 1200px;
        margin: 0 auto;
        padding: 48px 24px 80px;
      }

      header {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 32px;
      }

      header h1 {
        font-size: clamp(1.8rem, 3vw, 2.4rem);
        margin: 0;
        letter-spacing: -0.5px;
      }

      .clock {
        font-weight: 600;
        background: var(--panel);
        padding: 10px 16px;
        border-radius: 12px;
        box-shadow: 0 18px 35px rgba(0, 0, 0, 0.35);
      }

      section {
        background: var(--panel);
        margin-bottom: 24px;
        border-radius: 18px;
        padding: 24px;
        box-shadow: 0 22px 40px rgba(0, 0, 0, 0.32);
        border: 1px solid rgba(148, 163, 184, 0.08);
      }

      .section-title {
        margin: 0 0 18px;
        font-size: 1.1rem;
        text-transform: uppercase;
        letter-spacing: 1.2px;
        color: var(--muted);
      }

      .grid {
        display: grid;
        gap: 18px;
      }

      .grid.stats {
        grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      }

      .card {
        background: linear-gradient(
          155deg,
          rgba(59, 130, 246, 0.12),
          rgba(15, 23, 42, 0.6)
        );
        border-radius: 16px;
        padding: 20px;
        display: grid;
        gap: 6px;
        border: 1px solid rgba(59, 130, 246, 0.28);
      }

      .card strong {
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: rgba(226, 232, 240, 0.75);
      }

      .card span {
        font-size: 1.4rem;
        font-weight: 600;
      }

      .table-wrapper {
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 720px;
      }

      th,
      td {
        padding: 14px 12px;
        text-align: left;
        border-bottom: 1px solid rgba(148, 163, 184, 0.08);
      }

      th {
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 1.3px;
        color: rgba(226, 232, 240, 0.65);
        background: rgba(148, 163, 184, 0.06);
      }

      tbody tr:hover {
        background: rgba(59, 130, 246, 0.08);
      }

      input[type="number"] {
        background: rgba(148, 163, 184, 0.08);
        border: 1px solid rgba(148, 163, 184, 0.2);
        border-radius: 10px;
        padding: 8px 10px;
        color: inherit;
        width: 100px;
        font-size: 0.95rem;
      }

      input[type="number"]:focus {
        outline: 2px solid var(--accent);
        border-color: transparent;
      }

      .change-positive {
        color: var(--positive);
      }

      .change-negative {
        color: var(--negative);
      }

      button {
        background: var(--accent);
        color: white;
        border: none;
        border-radius: 12px;
        padding: 12px 20px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 20px 30px rgba(59, 130, 246, 0.25);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 16px 26px rgba(59, 130, 246, 0.3);
      }

      .news-grid {
        display: grid;
        gap: 16px;
      }

      .news-card {
        border-radius: 14px;
        padding: 18px;
        background: rgba(148, 163, 184, 0.05);
        border: 1px solid rgba(148, 163, 184, 0.1);
        transition: transform 0.2s ease, border-color 0.2s ease;
      }

      .news-card:hover {
        transform: translateY(-2px);
        border-color: rgba(59, 130, 246, 0.4);
      }

      .news-card h3 {
        margin: 0 0 10px;
        font-size: 1rem;
      }

      .news-meta {
        display: flex;
        gap: 12px;
        font-size: 0.8rem;
        color: rgba(226, 232, 240, 0.65);
        margin-bottom: 10px;
      }

      .signals {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 14px;
        border-radius: 999px;
        background: rgba(59, 130, 246, 0.1);
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.75rem;
      }

      .signals.buy {
        color: var(--positive);
        background: rgba(34, 197, 94, 0.12);
      }

      .signals.sell {
        color: var(--negative);
        background: rgba(239, 68, 68, 0.12);
      }

      .last-updated {
        margin-top: 12px;
        font-size: 0.85rem;
        color: var(--muted);
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin-top: 18px;
      }

      form.trade-form {
        display: grid;
        gap: 12px;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        background: rgba(148, 163, 184, 0.05);
        border-radius: 16px;
        padding: 18px;
        border: 1px solid rgba(148, 163, 184, 0.1);
        margin-bottom: 18px;
      }

      form.trade-form select,
      form.trade-form input {
        width: 100%;
        border-radius: 10px;
        border: 1px solid rgba(148, 163, 184, 0.2);
        background: rgba(148, 163, 184, 0.08);
        color: inherit;
        padding: 10px;
      }

      .trade-list {
        display: grid;
        gap: 12px;
      }

      .trade-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        padding: 14px 16px;
        border-radius: 12px;
        background: rgba(148, 163, 184, 0.07);
        border: 1px solid rgba(148, 163, 184, 0.1);
        font-size: 0.95rem;
      }

      .trade-item span {
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .empty {
        color: var(--muted);
        text-align: center;
        padding: 24px 12px;
      }

      @media (max-width: 720px) {
        header {
          justify-content: center;
          text-align: center;
        }

        .clock {
          order: 1;
        }
      }
    </style>
  </head>
  <body>
    <div class="shell">
      <header>
        <h1>Global Crypto Portfolio Intelligence</h1>
        <div class="clock" id="indianClock">Loading IST…</div>
      </header>

      <section id="globalSection">
        <h2 class="section-title">Global Market Pulse</h2>
        <div class="grid stats" id="globalStats">
          <div class="card">
            <strong>Total Market Cap (USD)</strong>
            <span id="globalMarketCap">–</span>
          </div>
          <div class="card">
            <strong>24h Volume (USD)</strong>
            <span id="globalVolume">–</span>
          </div>
          <div class="card">
            <strong>BTC Dominance</strong>
            <span id="btcDominance">–</span>
          </div>
          <div class="card">
            <strong>Active Cryptos</strong>
            <span id="activeCryptos">–</span>
          </div>
        </div>
        <div class="last-updated" id="globalUpdated">Awaiting data…</div>
      </section>

      <section>
        <h2 class="section-title">Portfolio Overview</h2>
        <div class="grid stats" id="portfolioHighlights">
          <div class="card">
            <strong>Portfolio Value (USD)</strong>
            <span id="portfolioValue">–</span>
          </div>
          <div class="card">
            <strong>24h Portfolio Move</strong>
            <span id="portfolioChange">–</span>
          </div>
          <div class="card">
            <strong>Best Performer</strong>
            <span id="bestPerformer">–</span>
          </div>
          <div class="card">
            <strong>Biggest Dip</strong>
            <span id="worstPerformer">–</span>
          </div>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Asset</th>
                <th>Holdings</th>
                <th>Live Price (USD)</th>
                <th>Value (USD)</th>
                <th>24h Change</th>
                <th>Signal</th>
              </tr>
            </thead>
            <tbody id="portfolioTable"></tbody>
          </table>
        </div>
        <div class="actions">
          <button id="savePortfolio">Save Portfolio</button>
          <div class="last-updated" id="priceUpdated">Refreshing…</div>
        </div>
      </section>

      <section>
        <h2 class="section-title">Live Trade Log</h2>
        <form class="trade-form" id="tradeForm">
          <select id="tradeAsset" required></select>
          <select id="tradeSide" required>
            <option value="buy">Buy</option>
            <option value="sell">Sell</option>
          </select>
          <input
            type="number"
            id="tradeAmount"
            placeholder="Amount"
            min="0"
            step="0.0001"
            required
          />
          <input
            type="number"
            id="tradePrice"
            placeholder="Price (USD)"
            min="0"
            step="0.01"
            required
          />
          <button type="submit">Log Trade</button>
        </form>
        <div class="trade-list" id="tradeList">
          <div class="empty">No trades yet. Capture live actions here.</div>
        </div>
      </section>

      <section>
        <h2 class="section-title">High-Impact Headlines (IST)</h2>
        <div class="news-grid" id="newsGrid">
          <div class="empty">Loading latest market intelligence…</div>
        </div>
      </section>
    </div>

    <script>
      const DEFAULT_HOLDINGS = {
        bitcoin: 0.25,
        ethereum: 2.5,
        tether: 4000,
        solana: 15,
        binancecoin: 3,
        ripple: 1200,
        cardano: 1500,
        dogecoin: 3000,
      };

      const COINGECKO_IDS = Object.keys(DEFAULT_HOLDINGS).join(",");
      const HOLDINGS_STORAGE_KEY = "crypto-portfolio-holdings";
      const TRADES_STORAGE_KEY = "crypto-trade-log";
      const PRICE_REFRESH_MS = 60 * 1000;
      const NEWS_REFRESH_MS = 5 * 60 * 1000;

      let holdings = loadHoldings();
      let marketData = {};

      const indianClock = document.getElementById("indianClock");
      const portfolioTable = document.getElementById("portfolioTable");
      const portfolioValueEl = document.getElementById("portfolioValue");
      const portfolioChangeEl = document.getElementById("portfolioChange");
      const bestPerformerEl = document.getElementById("bestPerformer");
      const worstPerformerEl = document.getElementById("worstPerformer");
      const priceUpdatedEl = document.getElementById("priceUpdated");
      const globalUpdatedEl = document.getElementById("globalUpdated");
      const tradeAssetSelect = document.getElementById("tradeAsset");
      const tradeListEl = document.getElementById("tradeList");

      function loadHoldings() {
        try {
          const stored = JSON.parse(localStorage.getItem(HOLDINGS_STORAGE_KEY));
          if (stored && typeof stored === "object") {
            return { ...DEFAULT_HOLDINGS, ...stored };
          }
        } catch (err) {
          console.warn("Failed to load holdings, using defaults.", err);
        }
        return { ...DEFAULT_HOLDINGS };
      }

      function saveHoldings() {
        const inputs = portfolioTable.querySelectorAll("input[data-asset]");
        inputs.forEach((input) => {
          const asset = input.dataset.asset;
          holdings[asset] = Number(input.value) || 0;
        });
        localStorage.setItem(HOLDINGS_STORAGE_KEY, JSON.stringify(holdings));
        animateButton(document.getElementById("savePortfolio"));
      }

      function renderHoldings() {
        portfolioTable.innerHTML = "";
        Object.entries(holdings).forEach(([asset, amount]) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td style="font-weight:600;text-transform:capitalize;">${asset.replace(
              /-/g,
              " "
            )}</td>
            <td><input type="number" step="0.0001" min="0" value="${amount}" data-asset="${asset}" /></td>
            <td id="${asset}-price">–</td>
            <td id="${asset}-value">–</td>
            <td id="${asset}-change">–</td>
            <td id="${asset}-signal"><span class="signals">Waiting</span></td>
          `;
          portfolioTable.appendChild(row);
        });
        populateTradeAssets();
      }

      function populateTradeAssets() {
        tradeAssetSelect.innerHTML = "";
        Object.keys(holdings).forEach((asset) => {
          const option = document.createElement("option");
          option.value = asset;
          option.textContent = asset.toUpperCase();
          tradeAssetSelect.appendChild(option);
        });
      }

      function formatCurrency(value) {
        return Number(value || 0).toLocaleString("en-US", {
          style: "currency",
          currency: "USD",
          maximumFractionDigits: 2,
        });
      }

      function formatPercent(value) {
        const num = Number(value || 0);
        const formatted = `${num >= 0 ? "+" : ""}${num.toFixed(2)}%`;
        return {
          text: formatted,
          className: num >= 0 ? "change-positive" : "change-negative",
        };
      }

      function computePortfolioHighlights() {
        let totalValue = 0;
        let totalChange = 0;
        let best = { name: "–", change: -Infinity };
        let worst = { name: "–", change: Infinity };

        Object.entries(holdings).forEach(([asset, amount]) => {
          const data = marketData[asset];
          if (!data) return;
          const value = amount * data.current_price;
          totalValue += value;
          totalChange += value * (data.price_change_percentage_24h / 100);

          if (data.price_change_percentage_24h > best.change) {
            best = {
              name: asset.toUpperCase(),
              change: data.price_change_percentage_24h,
            };
          }
          if (data.price_change_percentage_24h < worst.change) {
            worst = {
              name: asset.toUpperCase(),
              change: data.price_change_percentage_24h,
            };
          }
        });

        portfolioValueEl.textContent = formatCurrency(totalValue);
        portfolioChangeEl.textContent = `${totalChange >= 0 ? "+" : "-"}${formatCurrency(
          Math.abs(totalChange)
        )}`;

        if (best.name !== "–") {
          bestPerformerEl.textContent = `${best.name} (${best.change.toFixed(
            2
          )}%)`;
        } else {
          bestPerformerEl.textContent = "–";
        }

        if (worst.name !== "–") {
          worstPerformerEl.textContent = `${worst.name} (${worst.change.toFixed(
            2
          )}%)`;
        } else {
          worstPerformerEl.textContent = "–";
        }
      }

      async function fetchPrices() {
        try {
          const endpoint = `https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&ids=${COINGECKO_IDS}&order=market_cap_desc&sparkline=false&price_change_percentage=1h,24h`;
          const response = await fetch(endpoint);
          const data = await response.json();
          const now = new Date();

          data.forEach((coin) => {
            const asset = coin.id;
            marketData[asset] = coin;
            const priceEl = document.getElementById(`${asset}-price`);
            const valueEl = document.getElementById(`${asset}-value`);
            const changeEl = document.getElementById(`${asset}-change`);
            const signalEl = document.getElementById(`${asset}-signal`);

            if (!priceEl) return;

            priceEl.textContent = formatCurrency(coin.current_price);
            const value = (holdings[asset] || 0) * coin.current_price;
            valueEl.textContent = formatCurrency(value);

            const change = formatPercent(coin.price_change_percentage_24h);
            changeEl.textContent = change.text;
            changeEl.className = change.className;

            const signal =
              coin.price_change_percentage_24h >= 1.5
                ? { label: "Buy", tone: "buy" }
                : coin.price_change_percentage_24h <= -1.5
                ? { label: "Sell", tone: "sell" }
                : { label: "Hold", tone: "" };

            signalEl.innerHTML = `<span class="signals ${signal.tone}">${signal.label}</span>`;
          });

          computePortfolioHighlights();
          priceUpdatedEl.textContent = `Last refreshed ${toIST(now)} IST`;
        } catch (err) {
          console.error("Price update failed", err);
          priceUpdatedEl.textContent = "Price update failed. Retrying shortly…";
        }
      }

      async function fetchGlobalStats() {
        try {
          const response = await fetch("https://api.coingecko.com/api/v3/global");
          const { data } = await response.json();
          const now = new Date();
          document.getElementById("globalMarketCap").textContent =
            formatCurrency(data.total_market_cap.usd);
          document.getElementById("globalVolume").textContent = formatCurrency(
            data.total_volume.usd
          );
          document.getElementById(
            "btcDominance"
          ).textContent = `${data.market_cap_percentage.btc.toFixed(2)}%`;
          document.getElementById(
            "activeCryptos"
          ).textContent = data.active_cryptocurrencies.toLocaleString("en-IN");

          globalUpdatedEl.textContent = `Global metrics synced ${toIST(
            now
          )} IST`;
        } catch (err) {
          console.error("Global stats failed", err);
          globalUpdatedEl.textContent = "Global data failed to load.";
        }
      }

      async function fetchNews() {
        const newsGrid = document.getElementById("newsGrid");
        try {
          const response = await fetch(
            "https://min-api.cryptocompare.com/data/v2/news/?lang=EN"
          );
          const payload = await response.json();
          const items = payload.Data?.slice(0, 8) || [];

          if (!items.length) {
            newsGrid.innerHTML =
              '<div class="empty">No live headlines available right now.</div>';
            return;
          }

          newsGrid.innerHTML = items
            .map((item) => {
              const published = toIST(new Date(item.published_on * 1000));
              const categories = (item.categories || "General").split("|");
              return `
                <article class="news-card">
                  <div class="news-meta">
                    <span>${categories.slice(0, 2).join(" • ")}</span>
                    <span>${published} IST</span>
                  </div>
                  <h3>${item.title}</h3>
                  <p>${item.body
                    .replace(/<[^>]+>/g, "")
                    .slice(0, 220)}…</p>
                  <a href="${item.url}" target="_blank" rel="noopener noreferrer" style="color:var(--accent);font-weight:600;">Read live update →</a>
                </article>
              `;
            })
            .join("");
        } catch (err) {
          console.error("News update failed", err);
          newsGrid.innerHTML =
            '<div class="empty">Unable to fetch news. Please try again soon.</div>';
        }
      }

      function toIST(date) {
        return new Date(date).toLocaleString("en-IN", {
          timeZone: "Asia/Kolkata",
          hour12: true,
        });
      }

      function tickClock() {
        indianClock.textContent = toIST(new Date());
      }

      function animateButton(button) {
        button.style.transform = "scale(0.98)";
        setTimeout(() => {
          button.style.transform = "scale(1)";
        }, 150);
      }

      function initPortfolio() {
        renderHoldings();
        fetchPrices();
        fetchGlobalStats();
        fetchNews();

        setInterval(fetchPrices, PRICE_REFRESH_MS);
        setInterval(fetchGlobalStats, PRICE_REFRESH_MS * 2);
        setInterval(fetchNews, NEWS_REFRESH_MS);
        setInterval(tickClock, 1000);
        tickClock();
      }

      document
        .getElementById("savePortfolio")
        .addEventListener("click", saveHoldings);

      document.getElementById("tradeForm").addEventListener("submit", (event) => {
        event.preventDefault();
        const asset = tradeAssetSelect.value;
        const side = document.getElementById("tradeSide").value;
        const amount = Number(document.getElementById("tradeAmount").value);
        const price = Number(document.getElementById("tradePrice").value);

        if (!asset || !amount || !price) return;

        const trade = {
          asset: asset.toUpperCase(),
          side,
          amount,
          price,
          timestamp: new Date().toISOString(),
        };

        const trades = getTrades();
        trades.unshift(trade);
        localStorage.setItem(TRADES_STORAGE_KEY, JSON.stringify(trades));
        renderTrades(trades);
        event.target.reset();
      });

      function getTrades() {
        try {
          const stored = JSON.parse(localStorage.getItem(TRADES_STORAGE_KEY));
          if (Array.isArray(stored)) return stored;
        } catch (err) {
          console.warn("Trade log load failed", err);
        }
        return [];
      }

      function renderTrades(trades = getTrades()) {
        if (!trades.length) {
          tradeListEl.innerHTML =
            '<div class="empty">No trades yet. Capture live actions here.</div>';
          return;
        }

        tradeListEl.innerHTML = trades
          .slice(0, 12)
          .map((trade) => {
            const ts = toIST(new Date(trade.timestamp));
            const tone = trade.side === "buy" ? "buy" : "sell";
            const label = trade.side === "buy" ? "Buy" : "Sell";
            const value = trade.amount * trade.price;
            return `
              <div class="trade-item">
                <span style="text-transform:uppercase;font-weight:600;">${trade.asset}</span>
                <span class="signals ${tone}" style="font-size:0.8rem;">${label}</span>
                <span>${trade.amount.toFixed(4)} units @ ${formatCurrency(
              trade.price
            )}</span>
                <span>Total ${formatCurrency(value)}</span>
                <span style="color:var(--muted);font-size:0.8rem;">${ts} IST</span>
              </div>
            `;
          })
          .join("");
      }

      renderTrades();
      initPortfolio();
    </script>
  </body>
</html>
